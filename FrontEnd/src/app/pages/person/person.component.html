<div class="container">
    <div class="header">
      <h2 class="title">Personas</h2>
      <button class="btn-new" (click)="openModal()">Agregar Nueva Persona</button>
    </div>
  
    <div class="table-wrapper">
      <table class="table">
        <thead>
          <tr>
            <th>Nombres</th>
            <th>Apellidos</th>
            <th>Correo Electrónico</th>
            <th>Fecha de Nacimiento</th>
            <th>Género</th>
            <th>Ciudad</th>
            <th>Documento</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let person of persons">
            <td>{{ person.firstName }} {{ person.secondName }}  </td>
            <td> {{ person.firstLastName }} {{ person.secondLastName }}</td>
            <td>{{ person.email }}</td>
            <td>{{ person.dateOfBirth | date: 'dd/MM/yyyy' }}</td>
            <td>{{ person.gender }}</td>
            <td>{{ getCityName(person.cityId) }}</td>
            <td>{{ person.typeDocument }} - {{ person.numberDocument }}</td>
            <td>{{ person.state ? 'Activo' : 'Inactivo' }}</td>
            <td>
              <button class="btn-icon edit" (click)="editPerson(person)"><i class="fas fa-edit"></i></button>
              <button class="btn-icon delete" (click)="deletePerson(person.id)"><i class="fas fa-trash-alt"></i></button>
            </td>
          </tr>
          <tr *ngIf="persons.length === 0">
            <td colspan="9" class="no-results">No se encontraron personas</td>
          </tr>
        </tbody>
      </table>
    </div>
  
    <!-- Modal -->
    <ng-template #personModal let-modal>
      <div class="modal-header">
        <h5 class="modal-title" id="modal-basic-title">Formulario de Persona</h5>
        <button type="button" class="close" aria-label="Cerrar" (click)="modal.dismiss('Cross click')">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #personForm="ngForm" (ngSubmit)="onSubmit(personForm)">
          <div class="form-group">
            <label for="firstName">Primer Nombre</label>
            <input type="text" id="firstName" [(ngModel)]="person.firstName" name="firstName" class="input-field" required>
          </div>
          <div class="form-group">
            <label for="secondName">Segundo Nombre</label>
            <input type="text" id="secondName" [(ngModel)]="person.secondName" name="secondName" class="input-field">
          </div>
          <div class="form-group">
            <label for="firstLastName">Primer Apellido</label>
            <input type="text" id="firstLastName" [(ngModel)]="person.firstLastName" name="firstLastName" class="input-field" required>
          </div>
          <div class="form-group">
            <label for="secondLastName">Segundo Apellido</label>
            <input type="text" id="secondLastName" [(ngModel)]="person.secondLastName" name="secondLastName" class="input-field">
          </div>
          <div class="form-group">
            <label for="email">Correo Electrónico</label>
            <input type="email" id="email" [(ngModel)]="person.email" name="email" class="input-field" required>
          </div>
          <div class="form-group">
            <label for="dateOfBirth">Fecha de Nacimiento</label>
            <input type="date" id="dateOfBirth" [(ngModel)]="person.dateOfBirth" name="dateOfBirth" class="input-field" required>
          </div>
          
          <div class="form-group">
            <label for="gender">Género</label>
            <select type="text" id="gender" [(ngModel)]="person.gender" name="gender" class="input-field" required>
              <option value="MASCULINO">Masculino</option>
              <option value="FEMENINO">Femenino</option>
            </select>

          </div>
          <div class="form-group">
            <label for="city">Ciudad</label>
            <input type="text" id="city" 
                   [(ngModel)]="selectedCity" 
                   name="city" 
                   class="input-field city-input" 
                   (input)="filterCities()" 
                   (focus)="showDropdown = true" 
                   (blur)="onBlur()" 
                   autocomplete="off" required>
            <ul class="city-dropdown" *ngIf="showDropdown && filteredCities.length > 0">
              <li *ngFor="let city of filteredCities" 
                  (click)="selectCity(city)">
                {{ city.name }}
              </li>
            </ul>
          </div>
          
          
          <div class="form-group">
            <label for="typeDocument">Tipo de Documento</label>
            <select id="typeDocument" [(ngModel)]="person.typeDocument" name="typeDocument" class="input-field" required>
              <option value="CC">Cédula de Ciudadanía (CC)</option>
              <option value="TI">Tarjeta de Identidad (TI)</option>
            </select>
          </div>          
          
          <div class="form-group">
            <label for="numberDocument">Número de Documento</label>
            <input type="text" id="numberDocument" [(ngModel)]="person.numberDocument" name="numberDocument" class="input-field" required>
          </div>
          <div class="form-group" *ngIf="person.id !== 0">
            <label for="state">Estado</label>
            <input type="checkbox" id="state" [(ngModel)]="person.state" name="state" class="checkbox-field">
            <label for="state">Activo</label>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="modal.dismiss('cancel click')">Cancelar</button>
            <button type="submit" class="btn btn-primary">Guardar</button>
          </div>
        </form>
      </div>
    </ng-template>
</div>
